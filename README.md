# Тестовое Spring Boot приложение

### Назначение
Приложение под управлением Spring Boot Web с аутентификацией и авторизацией через сервер Keycloak ver 26.1.2.

### Подготовка
1. Установите сервер аутентификации Keycloak 26.1.2 или выше - [https://www.keycloak.org/downloads](https://www.keycloak.org/downloads) 
2. Создать пустую базу данных в Postgres, настроить Keycloak на созданную новую базу данных, выполнить миграцию в новую базу данных командой `kc.bat(sh) import --dir={путь проекта}/import`
3. Запустить Keycloak `kc.bat(sh) start-dev`, админ пользователь на вход: ( qwe | qwe ) или ( admin | admin )
4. Запустить тестовое приложение

### Работа приложения
1. Главная страница приложения загрузиться по адресу `http://localhost:8080/keycloak/api/` (контроллер MainPageController). Вход на главную страницу выполняется через форму ввода логина и пароля пользователя. Заведено два тестовых пользователя:
    - alex | alex - пользователь с ролью USER
    - vitos | vitos - пользователь с ролью CONSUMER 
2. При входе на главную страницу приложения, отображаются несколько параметров из учетных данных пользователя, хранящихся в Keycloak. Для получения учетных данных используется класс авторизации AccessTokenService, который выполняет парсинг id токена. Класс предусмотрен для парсинга JWT и JSESSIONID токенов, которые представлены в spring разными классами, источники токенов - REST запросы или запросы с WEB.
3. На главной странице есть активная ссылка logout - по которой инициируется дефолтный метод завершения пользовательского сеанса. Этот метод настраивается в конфигурации безопасности Spring приложения, указанием обработчика завершения сеанса. В качестве обработчика используется кастомный обработчик, в который мы можем добавлять логику необходимую для выполнения при завершении пользовательского сеанса.

### Конечные точки REST API приложения

Приложение имеет несколько тестовых конечных точек rest api
1. http://localhost:8080/keycloak/api/users/change-password - доступ с Bearer токеном пользователя, с любой или совсем без роли
2. http://localhost:8080/keycloak/api/users/create - доступ с Bearer токеном пользователя, обязательно с ролью USER
3. http://localhost:8080/keycloak/api/users/well-known - открытый доступ без токена






